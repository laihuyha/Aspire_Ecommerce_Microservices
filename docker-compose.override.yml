# Development overrides - only contains development-specific overrides
# Uses environment variables with sensible defaults for development

services:
  catalog.api:
    build:
      context: .
      dockerfile: Services/Catalog/API/Dockerfile
      target: development
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      # Override these in your .env file for development
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD:-devpassword123}
      - REDIS_COMMANDER_USER=${REDIS_COMMANDER_USER:-admin}
      - REDIS_COMMANDER_PASSWORD=${REDIS_COMMANDER_PASSWORD:-devpassword123}
    volumes:
      # Mount source code for hot reload in development
      - ./Services/Catalog:/app/Services/Catalog:ro
      - ./BuildingBlocks:/app/BuildingBlocks:ro
      - ./Aspire/ServiceDefaults:/app/Aspire/ServiceDefaults:ro
    ports:
      - "6000:8080"  # HTTP
      - "6060:8081"  # HTTPS
    # Override resource limits for development
    deploy:
      resources:
        limits:
          memory: 1G
          cpus: '1.0'
        reservations:
          memory: 512M
          cpus: '0.5'

  catalog.db:
    environment:
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD:-devpassword123}
    ports:
      - "5433:5432"
    volumes:
      - ./db/postgres/catalog:/var/lib/postgresql/data

  distributedcache:
    ports:
      - "6379:6379"
    volumes:
      - ./db/redis:/data
    # Remove memory limits for development flexibility
    deploy:
      resources:
        limits:
          memory: 512M

  redis-commander:
    environment:
      - REDIS_COMMANDER_USER=${REDIS_COMMANDER_USER:-admin}
      - REDIS_COMMANDER_PASSWORD=${REDIS_COMMANDER_PASSWORD:-devpassword123}
    ports:
      - "7001:8081"
